# ProLife 桌面小组件

## 功能说明

桌面小组件是 ProLife 的独立轻量级窗口，用于快速查看和管理任务、项目和每日计划。

### 特性
- **三个视图标签**：
  - 任务：显示所有独立任务（不属于项目的任务），按优先级+DDL排序
  - 项目：显示项目概览和进度
  - 今日：显示今天的每日计划
- **实时同步**：支持本地文件 + Supabase 云端双数据源
- **快速操作**：直接勾选完成任务/计划，自动同步到主应用和云端
- **Pop-art 设计**：与主应用保持一致的视觉风格
- **暗色模式**：自动跟随系统主题
- **置顶功能**：可设置窗口始终置顶
- **托盘图标**：最小化到系统托盘，右键菜单快速操作

## 使用方法

### 方式一：从主应用启动（推荐）
1. 打开 ProLife 主应用
2. 点击顶部工具栏的 **小组件图标** (方格图标)
3. 小组件窗口会自动弹出

### 方式二：独立启动
1. 进入 `widget/` 目录
2. 双击 `start-widget.bat`
3. 或在命令行运行 `npx electron .`

### 方式三：从打包后的应用启动
1. 运行 `H:\claude\dist\ProLife-win32-x64\ProLife.exe`
2. 点击工具栏的小组件图标
3. 小组件会作为独立进程启动

## 数据同步机制

1. **主应用保存时**：自动导出数据到 `%APPDATA%/ProLife/widget-data.json`
2. **小组件启动时**：
   - 优先读取本地文件（快速显示）
   - 如果有云端认证信息，自动从 Supabase 拉取最新数据
3. **小组件操作时**：
   - 勾选任务/计划完成后，立即写入本地文件
   - 同时异步同步到 Supabase 云端
4. **自动刷新**：每 60 秒自动刷新一次数据

## 打包说明

小组件已集成到主应用的打包配置中：
- `package.json` 的 `build.files` 包含了 `widget/**/*`
- 打包后的应用会包含完整的 widget 目录
- 使用 `npm run build:win` 打包时会自动包含小组件

## 技术细节

- **独立进程**：使用 `child_process.spawn` 启动，与主应用进程分离
- **数据共享**：通过文件系统共享数据（`%APPDATA%/ProLife/widget-data.json`）
- **窗口特性**：400x700 无边框透明窗口，支持拖拽和置顶
- **位置记忆**：窗口位置保存在 `%APPDATA%/ProLife/widget-pos.json`

## 注意事项

1. 小组件仅在 Electron 桌面版中可用（Web 版不支持）
2. 首次启动小组件前，请先运行主应用至少一次（生成数据文件）
3. 如果小组件无法启动，检查 `%APPDATA%/ProLife/` 目录是否存在
4. 任务标签页只显示独立任务，项目内的任务请在"项目"标签页查看
